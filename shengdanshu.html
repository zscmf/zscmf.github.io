<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>Merry Christmas - ç¥å®å®åœ£è¯èŠ‚å¿«ä¹</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: radial-gradient(circle at center, #1a0a0a 0%, #000000 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: "Microsoft YaHei", sans-serif;
      }
      #canvas {
        display: block;
        z-index: 1;
      }

      /* å¼¹çª—æ ·å¼ */
      .popup {
        position: absolute;
        padding: 12px 20px;
        border-radius: 50px; /* åœ†è§’æ°”æ³¡æ„Ÿ */
        font-weight: bold;
        font-size: 16px;
        color: white;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        z-index: 100;
        pointer-events: none;
        white-space: nowrap;
        animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        align-items: center;
        border: 2px solid rgba(255, 255, 255, 0.2);
      }

      @keyframes popIn {
        0% {
          transform: scale(0) translate(0, 20px);
          opacity: 0;
        }
        100% {
          transform: scale(1) translate(0, 0);
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        to {
          opacity: 0;
          transform: scale(0.8) translateY(-30px);
        }
      }

      /* åº•éƒ¨æ–‡å­—å®¹å™¨ */
      .ui-container {
        position: absolute;
        bottom: 5%;
        left: 0;
        width: 100%;
        text-align: center;
        pointer-events: none;
        z-index: 10;
      }
      .main-title {
        color: #ff4d4d;
        font-size: 2.2rem;
        font-weight: bold;
        letter-spacing: 4px;
        text-shadow: 0 0 15px rgba(255, 77, 77, 0.6);
        margin-bottom: 5px;
      }
      .sub-text {
        color: rgba(255, 255, 255, 0.6);
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>

    <div class="ui-container">
      <div class="main-title">MERRY CHRISTMAS</div>
      <div class="sub-text">â€”â€” æ„¿å®å®æ°¸è¿œå¼€å¿ƒ â€”â€”</div>
    </div>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      let width, height;
      let particles = [];
      let snowflakes = [];
      let textParticles = [];

      // --- ã€å¼¹çª—ç¥ç¦è¯­é…ç½®ã€‘ ---
      const popupMessages = [
        "â¤ï¸ å®å®æ˜¯æœ€å¥½çš„",
        "ğŸ„ åœ£è¯å¿«ä¹",
        "ğŸ ä¸“å±å®å®çš„æƒŠå–œ",
        "ğŸŒŸ ä½ æ˜¯æˆ‘çš„å”¯ä¸€",
        "ğŸ§¸ æŠ±æŠ±å®å®",
        "ğŸ¦ æ¯å¤©éƒ½è¦ç”œç”œçš„",
        "ğŸ”¥ å®å®æœ€ç¾äº†å‘¢",
        "ğŸŒˆ é‡è§ä½ æœ€å¹¸è¿",
        "ğŸ’– å®å®å°±æ˜¯æœ€æ£’çš„å‘¢",
        "âœ¨ é—ªé—ªå‘å…‰çš„å¥³å­©",
        "â„ï¸ å®å®æ˜¯æœ€å‰å®³çš„å‘¢",
        "ğŸ”” å¿…å®šä¸Šå²¸",
        "ğŸ° ä¹Ÿè¦è®°å¾—å¼€å¿ƒå‘€",
        "ğŸ‘— å®å®æ˜¯è¿™ä¸–é—´æœ€ç¾",
        "ğŸ‘« å®å®æ¯å¤©éƒ½è¦å¼€å¿ƒ",
        "ğŸŒ™ å®å®å¿ƒæƒ³äº‹æˆ",
      ];

      // --- ã€åœ£è¯æ ‘é…ç½®ï¼šå·¨å¤§ç‰ˆã€‘ ---
      const secretMessage =
        "æœ€å¥½çš„å®å®ï¼Œè¿™æ£µæ ‘ç”±åƒä¸‡é¢—æ˜Ÿè¾°ç»„æˆï¼Œæ¯ä¸€é¢—éƒ½åœ¨è¯‰è¯´ç€å®å®çš„ç¾å¥½ã€‚æ„¿æœªæ¥çš„æ¯ä¸ªæ—¥å­ï¼Œå®å®éƒ½å¯ä»¥å¼€å¼€å¿ƒå¿ƒçš„å‘¢ã€‚";
      const treeHeight = 850;
      const treeBaseY = -350;
      // ----------------------------

      function init() {
        resize();
        createLayeredTree(); // æ¢å¤åˆ†å±‚ç»“æ„ç®—æ³•
        createSnow();
        createText();
        animate();
        setInterval(spawnPopup, 500); // å¼¹çª—ç”Ÿæˆé¢‘ç‡
      }

      function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
      }

      function spawnPopup() {
        const popup = document.createElement("div");
        popup.className = "popup";
        const colors = [
          "#FF6B6B",
          "#4ECDC4",
          "#FFE66D",
          "#FF922B",
          "#A29BFE",
          "#55E6C1",
          "#FD79A8",
        ];
        popup.style.backgroundColor =
          colors[Math.floor(Math.random() * colors.length)];
        popup.innerText =
          popupMessages[Math.floor(Math.random() * popupMessages.length)];

        const x = Math.random() * (window.innerWidth - 250) + 50;
        const y = Math.random() * (window.innerHeight - 300) + 100;
        popup.style.left = x + "px";
        popup.style.top = y + "px";

        document.body.appendChild(popup);
        setTimeout(() => {
          popup.style.animation = "fadeOut 0.6s forwards";
          setTimeout(() => popup.remove(), 600);
        }, 2000);
      }

      function project(x, y, z) {
        const perspective = 800;
        const scale = perspective / (perspective + z + 600);
        return {
          x: width / 2 + x * scale,
          y: height / 2 - y * scale,
          scale: scale,
        };
      }

      // æ ¸å¿ƒï¼šåˆ†å±‚ç»å…¸ç»¿åœ£è¯æ ‘ç”Ÿæˆç®—æ³•
      function createLayeredTree() {
        particles = [];
        const totalParticles = 4000;
        const tiers = 8;

        for (let i = 0; i < totalParticles; i++) {
          let hRel = Math.random();
          let hActual = hRel * treeHeight;

          const tierHeight = treeHeight / tiers;
          let tierPosition = (hActual % tierHeight) / tierHeight;
          tierPosition = Math.pow(tierPosition, 0.6);

          const baseRadius = (1 - hRel) * 350;
          const r =
            baseRadius *
            (1.1 - tierPosition * 0.7) *
            (0.8 + Math.random() * 0.2);
          const angle = Math.random() * Math.PI * 2;

          let color;
          const rand = Math.random();
          if (rand < 0.85) {
            // ç»å…¸æ£®æ—ç»¿
            color = [
              20 + Math.random() * 30,
              120 + Math.random() * 100,
              40 + Math.random() * 40,
            ];
          } else if (rand < 0.93) {
            // çº¢è‰²ç‚¹ç¼€
            color = [255, 50, 50];
          } else {
            // é‡‘è‰²ç‚¹ç¼€
            color = [255, 215, 0];
          }

          particles.push({
            x: Math.cos(angle) * r,
            y: hActual + treeBaseY,
            z: Math.sin(angle) * r,
            colorBase: color,
            alpha: 0.5 + Math.random() * 0.5,
            blinkOffset: Math.random() * Math.PI * 2,
            isDeco: rand >= 0.85,
          });
        }
      }

      function createSnow() {
        snowflakes = [];
        for (let i = 0; i < 150; i++) {
          snowflakes.push({
            x: (Math.random() - 0.5) * 2000,
            y: Math.random() * 1000,
            z: (Math.random() - 0.5) * 2000,
            speed: 1 + Math.random() * 2,
            radius: 1 + Math.random() * 2,
          });
        }
      }

      function createText() {
        textParticles = [];
        const chars = secretMessage.split("");
        const totalChars = chars.length;
        chars.forEach((char, i) => {
          const h =
            treeBaseY + treeHeight * 0.2 + (i / totalChars) * treeHeight * 0.7;
          const r = (1 - i / totalChars) * 50 + 250;
          textParticles.push({
            char: char,
            y: h,
            r: r,
            angleBase: i * 0.35,
          });
        });
      }

      function drawStar(cx, cy, spikes, outerRadius, innerRadius, color) {
        let rot = (Math.PI / 2) * 3;
        let step = Math.PI / spikes;
        ctx.beginPath();
        ctx.moveTo(cx, cy - outerRadius);
        for (let i = 0; i < spikes; i++) {
          ctx.lineTo(
            cx + Math.cos(rot) * outerRadius,
            cy + Math.sin(rot) * outerRadius
          );
          rot += step;
          ctx.lineTo(
            cx + Math.cos(rot) * innerRadius,
            cy + Math.sin(rot) * innerRadius
          );
          rot += step;
        }
        ctx.lineTo(cx, cy - outerRadius);
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.shadowBlur = 30;
        ctx.shadowColor = color;
        ctx.fill();
        ctx.shadowBlur = 0;
      }

      let time = 0;
      function animate() {
        ctx.clearRect(0, 0, width, height);
        time += 0.007;
        const rotationAngle = time * 0.5;

        // 1. é›ªèŠ±
        ctx.fillStyle = "rgba(255, 255, 255, 0.6)";
        snowflakes.forEach((s) => {
          s.y -= s.speed;
          if (s.y < treeBaseY - 200) s.y = height;
          const p = project(s.x, s.y, s.z);
          if (p.scale > 0) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, s.radius * p.scale, 0, Math.PI * 2);
            ctx.fill();
          }
        });

        // 2. æ’åºç²’å­ (æ·±åº¦æ„Ÿ)
        particles.sort((a, b) => {
          const za =
            a.x * Math.sin(rotationAngle) + a.z * Math.cos(rotationAngle);
          const zb =
            b.x * Math.sin(rotationAngle) + b.z * Math.cos(rotationAngle);
          return zb - za;
        });

        // 3. ç”»æ ‘
        particles.forEach((pt) => {
          const rx =
            pt.x * Math.cos(rotationAngle) - pt.z * Math.sin(rotationAngle);
          const rz =
            pt.x * Math.sin(rotationAngle) + pt.z * Math.cos(rotationAngle);
          const p = project(rx, pt.y, rz);
          if (p.scale > 0) {
            const blink = Math.sin(time * 3 + pt.blinkOffset) * 0.2 + 0.8;
            let size = pt.isDeco ? 4 * p.scale : 2.5 * p.scale;
            ctx.fillStyle = `rgba(${pt.colorBase[0]}, ${pt.colorBase[1]}, ${
              pt.colorBase[2]
            }, ${pt.alpha * p.scale * (pt.isDeco ? 1 : blink)})`;
            ctx.beginPath();
            ctx.arc(p.x, p.y, size, 0, Math.PI * 2);
            ctx.fill();
          }
        });

        // 4. åŠ å¤§å·æ–‡å­—ç¯ç»•
        textParticles.forEach((tp) => {
          const angle = tp.angleBase - time * 0.7;
          const p = project(
            Math.cos(angle) * tp.r,
            tp.y,
            Math.sin(angle) * tp.r
          );
          if (p.scale > 0.3) {
            const zDepth = Math.sin(angle);
            const alpha = Math.min(Math.max((zDepth + 1) / 2, 0.1), 1);
            ctx.font = `bold ${35 * p.scale}px 'Microsoft YaHei'`;
            ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
            ctx.textAlign = "center";
            ctx.fillText(tp.char, p.x, p.y);
          }
        });

        // 5. é¡¶ç«¯å¤§æ˜Ÿæ˜Ÿ
        const starP = project(0, treeBaseY + treeHeight + 35, 0);
        drawStar(
          starP.x,
          starP.y,
          5,
          30 * starP.scale,
          12 * starP.scale,
          "#fff000"
        );

        requestAnimationFrame(animate);
      }

      window.addEventListener("resize", () => {
        resize();
        init();
      });
      init();
    </script>
  </body>
</html>
